<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>루카와 마르카 : 지구탈출연구실</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #0b0b0f;
  overflow: hidden;
  touch-action: none;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}
canvas {
  position: absolute;
  inset: 0;
  width: 100vw;
  height: 100vh;
  background: #0e1020;
}

/* 상단 UI */
.topbar {
  position: absolute;
  left: 10px;
  right: 10px;
  top: max(10px, env(safe-area-inset-top));
  display: flex;
  justify-content: space-between;
  pointer-events: none;
}
.btn {
  pointer-events: auto;
  padding: 10px 14px;
  border-radius: 14px;
  background: rgba(12,16,28,0.6);
  border: 1px solid rgba(42,49,67,0.9);
  color: #e8f2ff;
  font-weight: 800;
  font-size: 12px;
  user-select: none;
}
.btn:active { transform: translateY(1px); }

/* 시작 안내 */
.startLayer {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.45);
}
.card {
  background: rgba(0,0,0,0.55);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 18px;
  padding: 18px;
  text-align: center;
  color: #e8f2ff;
}
.card h1 {
  font-size: 18px;
  margin: 0 0 8px 0;
}
.card p {
  font-size: 13px;
  margin: 0;
  opacity: 0.85;
}
.logo {
  margin-top: 10px;
  font-weight: 900;
  font-size: 13px;
  letter-spacing: 1px;
  color: #76d2c8;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div class="topbar">
  <div class="btn" id="btnSwap">SWAP (루카/마르카)</div>
  <div class="btn" id="btnRestart">RESTART</div>
</div>

<div class="startLayer" id="startLayer">
  <div class="card">
    <h1>루카와 마르카 : 지구탈출연구실</h1>
    <p>세로 슈팅 · 드래그 이동 · 자동 발사</p>
    <div class="logo">TERRA ESCAPE LAB</div>
  </div>
</div>

<script>
/* ================== 기본 설정 ================== */
const LOG_W = 540;
const LOG_H = 960;

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;
}
window.addEventListener("resize", resize);
resize();

function beginFrame() {
  ctx.setTransform(
    canvas.width / LOG_W, 0,
    0, canvas.height / LOG_H,
    0, 0
  );
}

const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
const lerp = (a,b,t)=>a+(b-a)*t;

/* ================== 이미지 로딩 ================== */
const imgLuca = new Image();
imgLuca.src = "assets/luca.png";

const imgMarca = new Image();
imgMarca.src = "assets/marca.png";

/* ================== 게임 상태 ================== */
let state = "TITLE";

/* ================== 플레이어 ================== */
const player = {
  x: LOG_W/2,
  y: LOG_H*0.8,
  r: 18,
  char: "LUCA",
  hp: 100,
};

/* ================== 입력 (드래그 이동) ================== */
let dragging = false;
canvas.addEventListener("pointerdown", e => {
  if (state === "TITLE") {
    state = "PLAY";
    document.getElementById("startLayer").style.display = "none";
  }
  dragging = true;
});
canvas.addEventListener("pointerup", ()=> dragging=false);
canvas.addEventListener("pointercancel", ()=> dragging=false);
canvas.addEventListener("pointermove", e => {
  if (!dragging) return;
  const rect = canvas.getBoundingClientRect();
  const nx = (e.clientX - rect.left) / rect.width;
  const ny = (e.clientY - rect.top) / rect.height;
  player.x = clamp(nx * LOG_W, 40, LOG_W-40);
  player.y = clamp(ny * LOG_H, LOG_H*0.45, LOG_H-60);
});

/* ================== UI 버튼 ================== */
document.getElementById("btnSwap").onclick = () => {
  if (state !== "PLAY") return;
  player.char = player.char === "LUCA" ? "MARCA" : "LUCA";
};
document.getElementById("btnRestart").onclick = () => {
  location.reload();
};

/* ================== 총알 ================== */
const bullets = [];
let fireCD = 0;

function fire(dt) {
  fireCD -= dt;
  if (fireCD > 0) return;
  bullets.push({
    x: player.x,
    y: player.y - 28,
    vy: -720,
    r: 4
  });
  fireCD = 0.12;
}

/* ================== 그리기 ================== */
function drawPlayer() {
  const img = player.char === "LUCA" ? imgLuca : imgMarca;
  const size = 72;
  ctx.drawImage(
    img,
    player.x - size/2,
    player.y - size/2,
    size, size
  );
}

/* ================== 메인 루프 ================== */
let last = performance.now();
function loop(t) {
  const dt = Math.min(0.033, (t-last)/1000);
  last = t;

  beginFrame();

  /* 배경 */
  ctx.fillStyle = "#0f1220";
  ctx.fillRect(0,0,LOG_W,LOG_H);

  if (state === "PLAY") {
    fire(dt);
  }

  /* 총알 업데이트 */
  for (let i=bullets.length-1;i>=0;i--) {
    const b = bullets[i];
    b.y += b.vy * dt;
    if (b.y < -40) bullets.splice(i,1);
  }

  /* 총알 그리기 */
  ctx.fillStyle = "#e8f2ff";
  for (const b of bullets) {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
    ctx.fill();
  }

  /* 플레이어 */
  drawPlayer();

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>
</body>
</html>

